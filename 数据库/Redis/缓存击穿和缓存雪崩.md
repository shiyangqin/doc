# 缓存击穿和缓存雪崩

缓存击穿：key对应的数据卷数据存在且这个key被大量请求，在redis中过期的瞬间，若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。

缓存雪崩：当缓存服务器重启或者大量缓存集中在某一个时间段失效，这样在失效的时候，也会给后端系统(比如DB)带来很大压力。

缓存击穿是一个key过期同时有大量并发请求导致的，缓存雪崩就是发生大量缓存击穿

## 解决方案

缓存击穿：

1. 热点数据设置为永不过期：缓存穿透是因为热点数据缓存过期的瞬间有大量请求被发给数据库导致的，最简单的方法就是将热点数据设置为永不过期。

2. 互斥锁(mutex key)：当缓存失效的时候，加一个锁，一个请求拿到锁后去请求数据库并回设缓存，其他请求等待回设缓存成功然后继续从缓存中读取

缓存雪崩：

1. 过期时间加上随机数：缓存雪崩是由于大量key同时过期导致的，将key的过期时间加上一个随机数，使key的过期时间分散开，就能有效避免大量key同时过期

2. 加锁排队（极其不建议）：将发往数据库的请求排队执行，这样虽然减轻了数据库的压力，但1000个请求999都在排队，体验差且治标不治本