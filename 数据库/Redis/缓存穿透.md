# 缓存穿透

## 什么时缓存穿透

正常情况下，我们去查询的数据都是存在的，但是当我们去大量查询一条不存在数据时，由于缓存和数据库都没有数据，每次请求都会发送给数据库，造成数据库压力过大而宕机。这种查询不存在数据的现象我们称为缓存穿透

## 解决方案

1. 缓存空值：缓存穿透是缓存中没有存要这些空值，从而导致每次查询都到数据库中，那么我们就可以将这些空值放到缓存中，后面再出现查询这个key的时间，直接返回null，这样就不用再去数据库查一下。缓存大量的空值会占用较大的内存，所以应该给空值设置一个较短的过期时间，例如60s

2. 布隆过滤器

## 布隆过滤器

+ 实现原理：

用一个很长的二进制向量（ 也可以理解成bit数组）和若干个哈希函数，这些哈希函数通过计算你要找到的值是否映射在这个二进制向量中。

布隆过滤器初始化的时候bit数组里的值都是0.

+ 当我们将一个元素加入布隆过滤器中的时候，会进行如下操作：

1. 使用布隆过滤器中的哈希函数对元素值进行计算，得到哈希值（也就是bit数组中的索引位置，有多少个个哈希函数就会得到多少个哈希值）。　　

2. 根据得到的哈希值，在bit数组中把这些哈希值对应下标的值都置为 1。

+ 当我们判断一个元素是否存在于布隆过滤器的时候，会进行如下操作：

1. 对给定元素再次进行相同的哈希计算；

2. 得到值之后判断位数组中的每个元素是否都为 1，如果值都为 1，那么说明这个值在布隆过滤器中，如果存在一个值不为 1，说明该元素不在布隆过滤器中。

+ 精确度

hash算法存在碰撞的可能，所以不同的数据可能hash为一个下标数据，故为了提高精确度就需要 使用多个hash 算法标记一个数据，和增大BIT数组的大小

也是因为如此，布隆过滤器判断为【数据存在】 可能数据并不存在，但是如果判断为【数据不存在】那么数据就一定是不存在的。
